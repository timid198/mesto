(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o){var i=e.name,a=e.link,u=e._id,s=e.likes,c=e.owner,l=n.myId,f=n.handlerRemoveClick,h=n.handlerLikesClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=i,this._link=a,this._id=u,this._likes=s,this._owner=c,this.myId=l,this._cardSelector=r,this._viewverCard=o,this._handlerRemoveClick=f,this.handlerLikesClick=h}var n,r;return n=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this.buttonLike=this._element.querySelector(".element__title-like"),this.counterLike=this._element.querySelector(".element__title-counter"),this.buttonDelete=this._element.querySelector(".element__trash"),this.cardImage=this._element.querySelector(".element__image"),this._element.querySelector(".element__title-counter").textContent=this._likes.length,this.cardImage.src=this._link,this.cardImage.alt=this._name,this._element.id=this._id,this._element.querySelector(".element__title-text").textContent=this._name,this.updateLike(),this._setEventListeners(),this._element}},{key:"isShowDelete",value:function(){return!this._owner._id===this.myId}},{key:"setDeleteHidden",value:function(){this.isShowDelete(this)&&(this.buttonDelete.style.display="none",this.buttonDelete.setAttribute("disabled",!0))}},{key:"renderCard",value:function(){!this._owner===this.myId&&(this.buttonDelete.style.display="none",this.buttonDelete.setAttribute("disabled",!0))}},{key:"deleteCard",value:function(){this._element.remove(),this._element=null}},{key:"isLiked",value:function(){var e=this;return!!this._likes.find((function(t){return t._id===e.myId}))}},{key:"updateLike",value:function(){this._element.querySelector(".element__title-counter").textContent=this._likes.length,this.isLiked()?this.buttonLike.classList.add("element__title-like_set"):this.buttonLike.classList.remove("element__title-like_set")}},{key:"setLikes",value:function(e){this._likes=e.likes,this.updateLike()}},{key:"_setEventListeners",value:function(){var e=this;this._owner._id!==this.myId&&(this.buttonDelete.classList.add("element__trash_unset"),this.buttonDelete.setAttribute("disabled",!0)),this.buttonLike.addEventListener("click",(function(){return e.handlerLikesClick()})),this.buttonDelete.addEventListener("click",(function(){e._handlerRemoveClick(),e.setDeleteHidden()})),this.cardImage.addEventListener("click",(function(){return e._viewverCard(e._name,e._link)}))}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElementSelector=n,this._validationSettings=t,this.setEventListeners=this._setEventListeners.bind(this),this._inputList=Array.from(this._formElementSelector.querySelectorAll(this._validationSettings.inputSelector)),this._buttonElement=this._formElementSelector.querySelector(this._validationSettings.submitButtonSelector)}var t,r;return t=e,(r=[{key:"_setEventListeners",value:function(e,t){this._checkInputValidity(e),this._toggleButtonState(e,t)}},{key:"_hasNotValidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(e,t){this._hasNotValidInput(this._inputList)?this.buttonDisabled(e,t):this.buttonEnabled(e,t)}},{key:"buttonEnabled",value:function(e,t){this._buttonElement.classList.remove(this._validationSettings.inactiveButtonClass),this._buttonElement.removeAttribute("disabled")}},{key:"buttonDisabled",value:function(e,t){this._buttonElement.classList.add(this._validationSettings.inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}},{key:"clearInputsFromError",value:function(e,t){var n=this;this._inputList.forEach((function(e){n._hideInputError(e)}))}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_hideInputError",value:function(e){var t=this._formElementSelector.querySelector("".concat(this._validationSettings.errorSelector,"_").concat(e.name));e.classList.remove(this._validationSettings.inputErrorClass),t.classList.remove(this._validationSettings.errorClass),t.textContent=""}},{key:"_showInputError",value:function(e,t){var n=this._formElementSelector.querySelector("".concat(this._validationSettings.errorSelector,"_").concat(e.name));e.classList.add(this._validationSettings.inputErrorClass),n.textContent=t,n.classList.add(this._validationSettings.errorClass)}},{key:"enableValidation",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._setEventListeners(t,e._buttonElement)}))}))}}])&&n(t.prototype,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){var r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=r,this._form=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){return t._renderer(e)}))}},{key:"addItem",value:function(e){this._form.prepend(e)}}])&&o(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupSelector=t,this._popupElement=document.querySelector(t),this._escClose=this._handleEscClose.bind(this),this._close=this.close.bind(this),this._clickCLoseFunction=this._clickClose.bind(this)}var t,n;return t=e,(n=[{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this._close()}},{key:"_clickClose",value:function(e){e.target!==this._popupElement.querySelector("".concat(this._popupSelector,"__close"))&&e.target!==e.currentTarget||this.close()}},{key:"open",value:function(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keyup",this._escClose)}},{key:"close",value:function(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keyup",this._escClose)}},{key:"setEventListeners",value:function(){this._popupElement.addEventListener("click",this._clickCLoseFunction)}}])&&a(t.prototype,n),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?p(e):t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(r);if(o){var n=d(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function a(e){var t,n=e.popupSelector,r=e.handleFormSubmit;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,n))._handleFormSubmit=r,t._popupForm=t._popupElement.querySelector(".popup__form"),t._inputList=t._popupForm.querySelectorAll(".popup__input"),t._submit=t._submitForm.bind(p(t)),t}return t=a,(n=[{key:"_getInputValues",value:function(){var e=this;return this._formValues={},this._inputList.forEach((function(t){return e._formValues[t.name]=t.value})),this._formValues}},{key:"_submitForm",value:function(e){e.preventDefault(),this._handleFormSubmit(this._getInputValues())}},{key:"setEventListeners",value:function(){l(d(a.prototype),"setEventListeners",this).call(this),this._popupForm.addEventListener("submit",this._submit)}},{key:"close",value:function(){l(d(a.prototype),"close",this).call(this),this._popupForm.reset()}}])&&c(t.prototype,n),a}(u);function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(t){var n=t.userNameSelector,r=t.userAboutSelector,o=t.userAvatarSelector,i=t._id;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userName=document.querySelector(n),this._userAbout=document.querySelector(r),this._userAvatar=document.querySelector(o),this._id=i}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{userName:this._userName.textContent,userAbout:this._userAbout.textContent}}},{key:"getId",value:function(){return this._id}},{key:"setUserInfoDefault",value:function(e){this._userName.textContent=e.name,this._userAbout.textContent=e.about,this._userAvatar.src=e.avatar,this._id=e._id}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about,r=e._id;this._userName.textContent=t,this._userAbout.textContent=n,this._id=r}},{key:"setUserAvatar",value:function(e){this._userAvatar.src=e}}])&&m(t.prototype,n),e}();function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=E(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=E(r);if(o){var n=E(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._image=t._popupElement.querySelector(".popup-view__image"),t._title=t._popupElement.querySelector(".popup-view__title"),t}return t=a,(n=[{key:"handleCardClick",value:function(e,t){k(E(a.prototype),"open",this).call(this),this._image.src=t,this._image.alt=e,this._title.textContent=e}}])&&b(t.prototype,n),a}(u);function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(t){var n=t.address,r=t.token,o=t.groupID;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._address=n,this._token=r,this._groupID=o}var t,n;return t=e,(n=[{key:"_checkPromise",value:function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}},{key:"getCards",value:function(){var e=this;return fetch("".concat(this._address,"v1/").concat(this._groupID,"/cards"),{headers:{authorization:"".concat(this._token)}}).then((function(t){return e._checkPromise(t)}))}},{key:"getUserData",value:function(){var e=this;return fetch("".concat(this._address,"v1/").concat(this._groupID,"/users/me"),{headers:{authorization:"".concat(this._token)}}).then((function(t){return e._checkPromise(t)}))}},{key:"pushUserData",value:function(e){var t=this;return fetch("".concat(this._address,"v1/").concat(this._groupID,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e.name),about:"".concat(e.about)})}).then((function(e){return t._checkPromise(e)}))}},{key:"pushAddCardData",value:function(e){var t=this;return fetch("".concat(this._address,"v1/").concat(this._groupID,"/cards"),{method:"POST",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e.name),link:"".concat(e.link)})}).then((function(e){return t._checkPromise(e)}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this._address,"v1/").concat(this._groupID,"/cards/").concat(e),{method:"DELETE",headers:{authorization:"".concat(this._token)}}).then((function(e){return e.ok?Promise.resolve("sucsess"):Promise.reject("Ошибка ".concat(e.status))}))}},{key:"changeCardsLikes",value:function(e,t){var n=this,r=t?"DELETE":"PUT";return fetch("".concat(this._address,"v1/").concat(this._groupID,"/cards/likes/").concat(e),{method:r,headers:{authorization:"".concat(this._token)}}).then((function(e){return n._checkPromise(e)}))}},{key:"changeAvatar",value:function(e){var t=this;return fetch("".concat(this._address,"v1/").concat(this._groupID,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(e)})}).then((function(e){return t._checkPromise(e)}))}}])&&w(t.prototype,n),e}(),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",errorSelector:".popup__error",formAddClass:"popup-add",formEditClass:"popup-edit",formAvatarClass:"popup-avatar"},D=document.querySelector(".profile__avatar"),O=document.querySelector(".popup-edit__window"),P=O.querySelector(".popup__input_name"),q=O.querySelector(".popup__input_about"),j=document.querySelector(".popup-edit__form"),A=document.querySelector(".popup-add__form"),R=document.querySelector(".popup-avatar__form"),T=document.querySelector(".profile__edit-button"),F=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__overlay"),N=new r(I,j);N.enableValidation();var V=new r(I,A);V.enableValidation();var B=new r(I,R);B.enableValidation();var U=new C(".popup-view");U.setEventListeners();var z={};function H(e,t){e.querySelector(I.submitButtonSelector).textContent=t?"Сохранение...":"Сохранить"}var J=new L({address:"https://mesto.nomoreparties.co/",token:"4f64f170-2de3-4b0f-8592-8133023e0f4d",groupID:"cohort-22"}),M=new i({renderer:function(e){var n;M.addItem((n=new t(e,{myId:K._id,handlerRemoveClick:function(){X.open(),z=n},handlerLikesClick:function(){J.changeCardsLikes(n._id,n.isLiked()).then((function(e){return n.setLikes(e)})).catch((function(e){return console.log(e)}))}},".template__element_simple",U.handleCardClick.bind(U))).generateCard())}},".elements");Promise.all([J.getCards(),J.getUserData()]).then((function(e){K.setUserInfoDefault(e[1]),M.renderItems(e[0])})).catch((function(e){return console.log(e)}));var G=new _({popupSelector:".popup-add",handleFormSubmit:function(e){H(A,!0),J.pushAddCardData({name:e.title,link:e.link}).then((function(e){M.renderItems([e])})).catch((function(e){return console.log(e)})).finally((function(){H(A,!1)})),G.close()}});G.setEventListeners(),F.addEventListener("click",(function(e){e.preventDefault(),V.buttonDisabled(),V.clearInputsFromError(),G.open()}));var K=new v({userNameSelector:".profile__visitor-name",userAboutSelector:".profile__visitor-attribute",userAvatarSelector:".profile__avatar"}),Q=new _({popupSelector:".popup-edit",handleFormSubmit:function(e){H(j,!0),J.pushUserData({name:e.name,about:e.about}).then((function(e){K.setUserInfo({name:e.name,about:e.about,id:e._id}),Q.close()})).catch((function(e){return console.log(e)})).finally((function(){H(j,!1)}))}});Q.setEventListeners(),T.addEventListener("click",(function(e){var t;e.preventDefault(),N.buttonEnabled(),N.clearInputsFromError(),t=K.getUserInfo(),P.value=t.userName,q.value=t.userAbout,Q.open()}));var W=new _({popupSelector:".popup-avatar",handleFormSubmit:function(e){H(R,!0),D.src=e.avatar,J.changeAvatar(e.avatar).then((function(){return console.log("Аватар обновлен")}),W.close()).catch((function(e){return console.log(e)})).finally((function(){H(R,!1)}))}});W.setEventListeners(),x.addEventListener("click",(function(e){e.preventDefault(),B.buttonDisabled(),B.clearInputsFromError(),W.open()}));var X=new _({popupSelector:".popup-delete",handleFormSubmit:function(){J.deleteCard(z._id).then((function(){return z.deleteCard()})).catch((function(e){return console.log(e)})),X.close()}});X.setEventListeners()})();